<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>OS-04-文件系统</title>
</head>
<body><h1 id='os'>OS</h1>
<h2 id='四文件系统'>四、文件系统</h2>
<h3 id='1）文件管理'>（1）文件管理</h3>
<ol start='' >
<li><p>引入文件的优点：用户使用方便；文件安全可靠；系统能有效的利用储存空间；文件可共享。</p>
</li>
<li><p>一个文件的属性</p>
<ol start='' >
<li>文件名：由创建文件的用户决定文件名，用于方便找到文件，同一目录下不允许有重名文件。</li>
<li>标识符：一个系统内的各文件标识符唯一，对用户来说无可读性，OS用于区分文件。</li>
<li>类型：指明文件的类型。</li>
<li>位置：文件存放的路径（针对用户）、在外存中的地址（面向系统）。</li>
<li>大小</li>
<li>创建时间/上次修改时间/创建者/所有者信息。</li>
<li>保护信息：对文件进行保护的访问控制信息。</li>

</ol>
</li>
<li><p>文件内部的数据如何组织：<img src="./assets/OS_b_images/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%882.57.10.png" alt="/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%882.57.10.png" style="zoom:25%;" /><img src="./assets/OS_b_images/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%882.57.42.png" alt="/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%882.57.42.png" style="zoom:25%;" /></p>
</li>
<li><p>文件之间如何组织：</p>
<p><img src="./assets/OS_b_images/1-2.png" alt="1-2" style="zoom:25%;" /><img src="./assets/OS_b_images/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%884.53.07.png" alt="/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%884.53.07.png" style="zoom:25%;" /></p>
</li>
<li><p>操作系统应该对上层提供的功能：</p>
<ol start='' >
<li>创建文件功能（create系统调用）——图形化界面会向下层调用这个功能。</li>
<li>读文件功能（read系统调用）</li>
<li>保存文件（write系统调用）——将文件的数据从内存写入外存。</li>
<li>删除文件（delete系统调用）</li>
<li>打开/关闭文件（open/close系统调用）——和我们在图形化界面打开/关闭文件不一样</li>

</ol>
</li>
<li><p>文件如何存放在外存<img src="./assets/OS_b_images/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%884.57.14.png" alt="/./%E6%88%AA%E5%B1%8F2022-11-24%20%E4%B8%8B%E5%8D%884.57.14.png" style="zoom:25%;" /></p>
</li>
<li><p>文件共享和文件保护</p>
</li>

</ol>
<h3 id='2）文件的逻辑结构'>（2）文件的逻辑结构</h3>
<ol start='' >
<li><p>按文件结构分类</p>
<ol start='' >
<li>无结构文件：指文件内的数据不再组成记录，只是由一串依次的<strong>字节</strong>组成的<strong>信息流序列</strong>，称为字节流文件，又称<strong>流式文件</strong>，如txt文件。</li>
<li>有结构文件：有一组相似的记录组成，又称<strong>记录式文件</strong>，每条记录有若干个数据项组成，如数据库文件。一般来说每条记录有一个数据项作为关键字，根据各记录的长度又可以分为定长记录和可变长记录。</li>

</ol>
</li>
<li><p>有结构文件的逻辑结构</p>
<ol start='' >
<li><p>顺序文件：文件中的记录一个接一个的顺序排列，记录可定长可变长。各个记录在物理上可以顺序储存和链式储存。</p>
<ol start='' >
<li><p>串结构：记录之间的顺序与关键字无关。</p>
</li>
<li><p>顺序结构：记录之间的顺序按关键字顺序排列。</p>
</li>
<li><p>链式存储：无论是定长/可变长记录，都无法实现随机存取，每次只能从第一个记录开始依次往后查找</p>
</li>
<li><p>顺序存储</p>
<ol start='' >
<li><p>可变长记录：无法实现随机存取。每次只能从第一个记录开始依次往后查找。</p>
</li>
<li><p>定长记录：</p>
<ol start='' >
<li>可实现随机存取。记录长度为L，则第i个记录存放的相对位置是i*L。</li>
<li>若采用串结构，无法快速找到某关键字对应的记录/</li>
<li>若采用顺序结构，可以快速找到某关键字对应的记录 (如折半查找)。</li>

</ol>
</li>

</ol>
<p><img src="./assets/OS_b_images/截屏2022-11-24 下午5.14.44.png" alt="/截屏2022-11-24 下午5.14.44.png" style="zoom:25%;" /></p>
</li>

</ol>
</li>

</ol>
</li>
<li><p>索引文件：索引文件有一个索引表记录文件的记录的信息，索引表本身是定长记录的顺序文件，因此可以快速找到第i个记录的索引。还可以支持二分查找，每次修改记录时都需要修改索引表。<strong>索引表的检索速度很高，因此主要用于对信息处理的及时性要求高的场合</strong>。</p>
</li>
<li><p>索引顺序文件：索引文件的索引表的表项可能很大，因此提出了索引顺序文件，索引顺序文件中不会为每个记录都建立表项，而是将记录分组，为每一个组建立索引表项。——也可以解决不定长记录的检索问题<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.26.45.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.26.45.png" style="zoom:25%;" /></p>
</li>
<li><p>多级索引顺序文件：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.27.56.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.27.56.png" style="zoom:25%;" /></p>
</li>

</ol>
<h3 id='3）文件目录'>（3）文件目录</h3>
<ol start='' >
<li><p>FCB 的有序集合称为“文件目录”，1个FCB就是1个文件目录项。FCB 中包含了文件的基本信息（文件名、物理地址、逻辑结构、物理结构等），存取控制信息（是否可读/可写、禁止访问的用户名单等），使用信息（如文件的建立时间、修改时间等）。最重要，最基本的还是 文件名、文件存放的物理地址。</p>
</li>
<li><p>对目录的操作：</p>
<ol start='' >
<li>搜索：当用户要使用一个文件时，系统要根据文件名搜索目录，找到该文件对应的目录项。</li>
<li>创建文件：创建一个新文件时，需要在其所属的目录中增加。</li>
<li>删除文件：当删除一个文件时，需要在目录中删除相应的目录项。</li>
<li>显示目录：用户可以请求品示目录的内容，如显示该目录中的所有文件及相应属性。</li>
<li>修改目录：某些文件属性存放在目录中，这些属性发生变化也需要修改。</li>

</ol>
</li>
<li><p>目录结构</p>
<ol start='' >
<li><p>单级目录结构：整个系统只建立一张目录表，每个文件占一个目录项。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.52.19.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.52.19.png" style="zoom:25%;" /></p>
</li>
<li><p>两级目录结构：采用两级目录结构，分为主文件目录（MFD）和用户文件目录（UFD)。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.53.02.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.53.02.png" style="zoom:25%;" /></p>
</li>
<li><p>多级目录结构（树形目录结构）：用户或进程想要访问文件时，需要用文件路径名标识文件，文件路径名是一个字符串，各级目录间用“/”隔开，从根目录出发的路径叫做绝对路径。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.55.13.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.55.13.png" style="zoom:25%;" /></p>
<p>在实际使用中，一个用户可能会连续访问同一目录内的多个文件，因此一次读入整个目录设置一个当前目录是十分高效的，从当前目录出发的路径就叫做相对路径。</p>
<p><font color=red>树形目录结构可以很方便地对文件进行分类，层次结构清晰，也能够更有效地进行文件的管理和保护。但树形结构不便于实现文件的共享。为此，提出了 “无环图目录结构。</font></p>
</li>
<li><p>无环图目录结构：可以使用不同的文件名指向同一个文件，甚至可以指向同一个目录（共享同一目录下的所有内容）。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.58.22.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8810.58.22.png" style="zoom:25%;" /></p>
<p>需要为每个共享结点设置一个共享计数器，用于记录此时有多少个地方在共享该结点。用户提出删除结点的请求时，只是删除该用户的FCB、并使共享计数器减1，并不会直接删除共享结点。只有共享计数器减为0时，才删除结点。
注意：共享文件不同于复制文件。在共享文件中，由于各用户指向的是同一个文件，因此只要其中一个用户修改了文件数据，那么所有用户都可以看到文件数据的变化。</p>
</li>

</ol>
</li>
<li><p>索引节点（FCB的改进）：在查找目录时只需要文件名就可以找到，因此可以让目录表瘦身来减小体量提高效率。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8811.00.01.png" alt="/%E6%88%AA%E5%B1%8F2022-11-25%20%E4%B8%8A%E5%8D%8811.00.01.png" style="zoom:25%;" /></p>
<p>当找到文件名对应的目录项时，才需要将索引结点调入内存，索引结点中记录了文件的各种信息，包括文件在外存中的存放位置，根据“存放位置” 即可找到文件/存放在外存中的索引结点称为 “磁盘索引结点”，当索引结点放入内存后称为 “内存索引结点”/相比之下内存索引结点中需要增加一些信息，比如：文件是否被修改、此时有几个进程正在访问该文件等。</p>
</li>

</ol>
<h3 id='4）文件的物理结构'>（4）文件的物理结构</h3>
<ol start='' >
<li><p>文件块：在外存管理中，为了方便对文件数据的管理，文件的逻辑地址也被分成了一个一个的文件块，于是文件的逻辑地址也可以用<strong>逻辑块号+块内地址</strong>的形式表示。用户在管理自己的文件时，就可以通过逻辑块号来管理文件，此时OS就要提供<strong>将文件的逻辑地址转换到物理地址的功能</strong>。</p>
</li>
<li><p>文件分配方式</p>
<ol start='' >
<li><p>连续分配：每个文件在磁盘上占有一组连续的块，在文件目录中记录存放的起始块号和长度。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-29%20%E4%B8%8B%E5%8D%889.35.55.png" alt="截屏2022-11-29 下午9.35.55" style="zoom:25%;" /></p>
<ol start='' >
<li>优势：连续分配支持顺序访问和直接访问；由于文件是连续存放的，磁头在读取磁盘时移动的距离短，速度快，<strong>连续分配文件在顺序读写时速度最快</strong>。</li>
<li>缺点：数据迁移的开销极大，物理上采用连续分配的文件对扩展极不友好；会产生大量磁盘碎片，储存空间利用率低（可以使用紧凑来处理碎片，但是消耗大）。</li>

</ol>
</li>
<li><p>链接分配：采取离散分配的方式，可以为文件分配离散的磁盘块。</p>
<ol start='' >
<li><p>隐式链接：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-29%20%E4%B8%8B%E5%8D%8810.02.00.png" alt="/%E6%88%AA%E5%B1%8F2022-11-29%20%E4%B8%8B%E5%8D%8810.02.00.png" style="zoom:25%;" /></p>
<ol start='' >
<li>用户给出要访问的逻辑块号i，OS找到该文件的FCB，读入第一个逻辑块，一直顺序读取到第i个，一共i+1次磁盘I/O</li>
<li>只支持顺序访问，不支持随机访问，查找效率低，块之间的链接也消耗空间。</li>
<li>扩展文件：对文件扩展方便，空间利用率高，效率高。</li>

</ol>
</li>
<li><p>显式链接：把用于连接文件的各物理块的指针显式的存放在一张表中，即文件分配表（<strong>FAT</strong>）。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-29%20%E4%B8%8B%E5%8D%8810.05.22.png" alt="/%E6%88%AA%E5%B1%8F2022-11-29%20%E4%B8%8B%E5%8D%8810.05.22.png" style="zoom:25%;" /></p>
<ol start='' >
<li>一个磁盘仅需要一个FAT即可，开机时读入FAT到内存并常驻内存。FAT的各个表项在物理上是连续储存，且每一个表象的长度相同，因此“物理块号”字段可以隐含。</li>
<li>用户给出需要的逻辑块号i，OS找到FCB，拿到起始块号，若i&gt;0则查询FAT往后一直找到i对应的物理块号。<strong>注意FAT常驻内存，因此这里只需要一次磁盘I/O。</strong></li>
<li>支持顺序访问和随机访问。访问速度快很多，无外部碎片，对文件扩展友好。</li>
<li>文件分配表需要占用空间。</li>

</ol>
</li>
<li><p><font color=green>如果未指明链接方式，默认隐式。</font></p>
</li>

</ol>
</li>
<li><p>索引分配</p>
<ol start='' >
<li><p>索引分配允许文件离散地分配在各个磁盘块中，系统会为每个文件建立一张索引表，索引表中记录了文件的各个逻辑块对应的物理块（索引表的功能类似于内存管理中的页表一一建立逻辑页面到物理页之间的映射关系）。索引表存放的磁盘块称为索引块，文件数据存放的磁盘块称为数据块。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-11-30%20%E4%B8%8B%E5%8D%881.50.56.png" alt="/%E6%88%AA%E5%B1%8F2022-11-30%20%E4%B8%8B%E5%8D%881.50.56.png" style="zoom:25%;" /></p>
</li>
<li><p>在显式链接的分配方式中，FAT是一张磁盘对应一个FAT，而索引表是一个文件对应一张。</p>
</li>
<li><p>用户给出逻辑块号i，OS找到FCB，得知索引表的位置，将索引表读入内存，并查找索引表获得块i的位置。</p>
</li>
<li><p>索引分配支持随机访问，文件扩展易实现，但是索引表需要占用储存。</p>
</li>
<li><p>问题：如果一个文件非常大，仅仅是文件的索引表就超过一个磁盘块的内存，该如何处理呢？</p>
<ol start='' >
<li>链接方案：如果索引表太大，一个索引块装不下，那么可以将多个索引块链接起来存放。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.40.33.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.40.33.png" style="zoom:25%;" />在上一个索引块的最后放置一个指针，指向下一个索引块——OS需要按顺序一个一个的读入索引块才能完全随机处理。</li>
<li>多层索引：建立多层索引（类似于多级页表），是第一层的索引块指向第二层索引块，等等。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.47.55.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.47.55.png" style="zoom:25%;" /><font color=red>注意这里需要了解如何根据索引表信息计算文件最大体积</font>。采用K层索引结构，且顶级索引表未调入内存，则访问一个数据块只需零K+1次读磁盘操作</li>
<li>混合索引：多种索引分配方式的结合，如：一个文件的顶级索引表中，既包含直接地址索引又包含一级间接索引又包含两级间接索引。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.51.35.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.51.35.png" style="zoom:25%;" /><font color=red>注意这里也需要了解如何根据索引表信息计算文件最大体积，这里访问磁盘操作次数需要根据具体读入的数据计算</font>。对于小文件来说，混合索引只需要较少的访问次数就可以获得数据块（计算机中小文件较多)。</li>

</ol>
</li>

</ol>
</li>

</ol>
</li>
<li><p>超级超级超级重要考点：①要会根据多层索引、混合索引的结构计算出文件的最大长度（Key：各级索引表最大不能超过一个块）；②要能自己分析访问某个数据块所需要的读磁盘次数(Key：FCB中会存有指向顶级索引块的指针，因此可以根据FCB读入顶级索引块。每次读入下一级的索引块都需要一次读磁盘操作。另外，要注意题目条件一一顶级索引块是否已调入内存）。</p>
</li>
<li><p><img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.56.39.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.56.39.png" style="zoom:25%;" /></p>
</li>

</ol>
<h3 id='5）文件储存空间管理'>（5）文件储存空间管理</h3>
<ol start='' >
<li><p>储存空间需要进行分区，如C盘和D盘等，将物理磁盘划分为一个个文件卷（逻辑卷、逻辑盘）。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.59.14.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%881.59.14.png" style="zoom:25%;" /></p>
</li>
<li><p>存储空间管理方法</p>
<ol start='' >
<li><p>空闲表法：建立一个空闲表，记录空闲的块的起始盘编号和连续的空闲块数。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%882.42.08.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%882.42.08.png" style="zoom:25%;" /></p>
<ol start='' >
<li>适用于“连续分配方法”。</li>
<li>回收磁盘块：与内存管理中的动态分区分配很类似，当回收某个存储区时需要有四种情况一一（1）回收区的前后都没有相邻空闲区；（2）回收区的前后都是空闲区：（3）回收区前面是空闲区；（4）回收区后面是空闲区。总之，回收时需要注意表项的合并问题。</li>

</ol>
</li>
<li><p>空闲链表法<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%882.54.29.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%882.54.29.png" style="zoom:25%;" /></p>
<ol start='' >
<li><p>空闲盘块链：OS保存着链头和链尾的指针。</p>
<p>如何分配：若某文件申请K个盘块，则从链头开始依次摘下K个盘块分配，并修改空闲链的链头指针。</p>
<p>如何回收：回收的盘块依次挂到链尾，并修改空闲链的链尾指针。</p>
<p>适用于离散分配的物理结构。为文件分配多个盘块时可能要重复多次操作。</p>
</li>
<li><p>空闲盘区链：操作系统保存着链头、链尾指针。</p>
<p>如何分配：若某文件申请K个盘块，则可以采用首次适应、最佳适应等算法，从链头开始检索，按照算法规则找到一个大小符合要求的空闲盘区分配给文件。若没有合适的连续空闲块，也可以将不同盘区的盘块同时分配给一个文件，注意分配后可能要修改相应的链指针、盘区大小等数据。</p>
<p>如何回收：若回收区和某个空闲盘区相邻，则需要将回收区合并到空闲盘区中。若回收区没有和任何空闲区相邻，将回收区作为单独的一个空闲盘区挂到链尾。</p>
</li>

</ol>
</li>
<li><p>位示图法</p>
<ol start='' >
<li><p>可以理解成状压DP的模式，每个二进制位对应一个盘块，用0/1表示空闲或分配。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.11.32.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.11.32.png" style="zoom:25%;" /></p>
</li>
<li><p>和状压DP一样，这样的储存方式受限于字长的影响，因此，可以用（字号，位号）的方式来对应一个盘块号，也可以描述为（行号，列号）。<font color=blue>这里一定要注意字号和位号是从0开始还是从1开始的。</font></p>
</li>
<li><p>如何分配：若文件需要K个块，①顺序扫描位示图，找到K个相邻或不相邻的“0”；②根据字号、位号算出对应的盘块号，将相应盘块分配给文件；③将相应位设置为“1”。</p>
<p>如何回收：①根据回收的盘块号计算出对应的字号、位号；②将相应二进制位设为“0”。</p>
</li>

</ol>
</li>
<li><p>成组链接法</p>
<ol start='' >
<li><p>文件卷的目录区中专门用一个磁盘块作为“超级块”，当系统启动时需要将超级块读入内存，并且保证内存与外存中的超级块数据一致。</p>
</li>
<li><p>超级块（这个块是一个空闲盘块的组合）记录了下一组空闲盘块数和空闲的块号。同时在下一组空闲盘块记录再下一个空闲盘块。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.18.40.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.18.40.png" style="zoom:25%;" /></p>
</li>
<li><p>如何分配？</p>
<ol start='' >
<li>需要100个空闲块：①检杳第一个分组的块数是否足够。100=100，是足够的。②分配第一个分组中的100个空闲块。但是由于300号块内存放了再下一组的信息，因此300号块的数据需要复制到超级块中。</li>

</ol>
</li>
<li><p>需要1个空闲块：①检杳第一个分组的块数是否
足够。1&lt;100，因此是足够的。②分配第一个分组中的1个空闲块，并修改相应数据。</p>
<p>如何回收？</p>
<ol start='' >
<li>假设每个分组最多为100个空闲块，此时第一个分组己有99个块，还要再回收一块。</li>

</ol>
</li>
<li><p>假设每个分组最多为100个空闲块，此时第一个分组己有100个块，还要再回收一块需要将超级块中的数据复制到新回收的块中，并修改超级块的内容，让新回收的块成为第一个分组。</p>
</li>

</ol>
</li>

</ol>
</li>

</ol>
<h3 id='6）文件的基本操作'>（6）文件的基本操作</h3>
<ol start='' >
<li><p>创建文件：进行create()系统调用时。</p>
<ol start='' >
<li><p>需要提供的几个主要参数：</p>
<ol start='' >
<li>所需的外存空间大小（如：一个盘块，即1KB）</li>
<li>文件名（这个地方默认为 “新建文本文档.txt”）</li>

</ol>
</li>
<li><p>操作系统在处理 Create 系统调用时，主要做了两件事：</p>
<ol start='' >
<li>在外存中找到文件所需的空间（结合上小节学习的空闲链表法、位示图、成组链接法等管理策略，找到空闲空间）。</li>
<li>根据文件存放路径的信息找到该目录对应的目录文件（此处就是D:/Demo 目录），在目录中创建该文件对应的目录项。目录项中包含了文件名、文件在外存中的存放位置等信息。</li>

</ol>
</li>

</ol>
</li>
<li><p>删除文件：进行Delete 系统调用时。</p>
<ol start='' >
<li><p>需要提供的几个主要参数：</p>
<ol start='' >
<li>文件存放路径(“D:/Demo”）</li>

</ol>
</li>
<li><p>操作系统在处理 Delete 系统调用时，主要做了几件事：</p>
<ol start='' >
<li>根据文件存放路径战到相应的目录文件，从目录中找到文件名对应的目录项。</li>
<li>根据该目录项记录的文件在外存的存放位置、文件大小等信息，回收文件占用的磁盘块(回收磁盘块时，根据空闲表法、空闲链表法、位图法等管理策略的不同，需要做不同的处理）。</li>
<li>从目录表中删除文件对应的目录项。</li>

</ol>
</li>

</ol>
</li>
<li><p>打开文件：在很多操作系统中，在对文件进行操作之前，要求用户先使用 open 系统调用“打开文件”。</p>
<ol start='' >
<li><p>需要提供的几个主要参数：</p>
<ol start='' >
<li>文件存放路径(“D:/Demo”）</li>
<li>要对文件的操作类型（如：r只读；rw读写等）。</li>

</ol>
</li>
<li><p>操作系统在处理 open 系统调用时，主要做了几件事：</p>
<ol start='' >
<li>根据文件存放路径找到相应的目录文件，从目录中找到文件名对应的目录项，并检查该用户是否有指定的操作权限。</li>
<li>将目录项复制到内存中的“打开文件表”中。并将对应表目的编号返回给用户。之后用户使用打开文件表的编号来指明要操作的文件。</li>

</ol>
</li>

</ol>
</li>

</ol>
<p>   打开文件表：可以方便实现某些文件管理的功能。例如：在Windows系统中，我们尝试删除某个txt文件，如果此时该文件己被某个“记事本”进程打开，则系统会提示我们“暂时无法删除该文件”。其实系统在背后做的事就是先检查了系统打开文件表，确认此时是杏有进程正在使用该文件。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.32.45.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.32.45.png" style="zoom:25%;" /></p>
<ol start='4' >
<li><p>关闭文件：进程使用完文件后，要“关闭文件”，操作系统在处理 Close 系统调用时，主要做了几件事：</p>
<ol start='' >
<li><p>将进程的打开文件表相应表项删除。</p>
</li>
<li><p>回收分配给该文件的内存空间等资源。</p>
</li>
<li><p>系统打开文件表的打开计数器count 减1，若 count=0，则删除对应表项。</p>
</li>
<li><p>f_count 和 i_count 分别反映进程动态地共享一个文件的两种方式</p>
<ol start='' >
<li>f_count 反映<strong>不同进程</strong>通过<strong>同一个</strong>系统打开文件表项共享一个文件的情况；</li>
<li>i_count 反映<strong>不同进程</strong>通过<strong>不同</strong>系统打开文件表项共享一个文件的情况。</li>

</ol>
</li>

</ol>
</li>
<li><p>读文件：进程使用read系统调用完成写操作。需要指明是哪个文件（在支持“打开文件” 操作的系统中，只需要提供文件在打开文件表中的索引号即可）还需要指明要读入多少数据（如：读入1KB）、指明读入的数据要放在内存中的什么位置。操作系统在处理read 系统调用时，会从读指针指向的外存中，将用户指定大小的数据读入用户指定的内存区域中。</p>
</li>
<li><p>写文件：进程使用 write 系统调用完成写操作，需要指明是哪个文件（在支持“打开文件” 操作的系统中，只需要提供文件在打开文件表中的索引号即可）还需要指明要写出多少数据（如：写出 1KB)、写回外存的数据放在内存中的什么位置操作系统在处理 write 系统调用时，会从用户指定的内存区域中，将指定大小的数据写回写指针指向的外存。</p>
</li>

</ol>
<h3 id='7）文件共享'>（7）文件共享</h3>
<ol start='' >
<li><p>多个用户共享同一个文件，意味着系统中只有“一份”文件数据。并且只要某个用户修改了该文件的数据，其他用户也可以看到文件数据的变化。如果是多个用户都“复制”了同一个文件，那么系统中会有“好几份” 文件数据。其中一个用户修改了自己的那份文件数据，对其他用户的文件数据并没有影响。</p>
</li>
<li><p>基于索引节点的共享方式（硬链接）</p>
<ol start='' >
<li>在索引节点中设置一个链接计数变量count，用于表示连接到本索引节点上的用户目录项数。</li>
<li>如果用户删除该文件，则只是把用户的目录中与该文件对应的目录项删除并把count减1。</li>

</ol>
</li>
<li><p>基于符号链的共享方式（软链接）</p>
<ol start='' >
<li><img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.43.51.png" alt="/%E6%88%AA%E5%B1%8F2022-12-02%20%E4%B8%8B%E5%8D%883.43.51.png" style="zoom:25%;" /></li>
<li>被共享的用户并不是为他建立一个直接指向原物理地址的文件，而是建立一个link文件，link文件再指向物理数据地址。</li>

</ol>
</li>

</ol>
<h3 id='8）文件保护'>（8）文件保护</h3>
<ol start='' >
<li><p>口令保护：为文件设置一个口令，用户请求访问该文件时必须提供口令。</p>
<ol start='' >
<li>口令一般存放在文件对应的 FCB 或索引结点中。用户访问文件前需要先输入“口令”操作系统会将用户提供的口令与FCB中存储的口令进行对比，如果正确，则允许该用户访问文件。</li>
<li>优点：保存口令的空间开销小，验证口令时间开销小。</li>
<li>缺点：口令存放在系统内部，不够安全。</li>

</ol>
</li>
<li><p>加密保护：使用某个密码对文件进行加密，在访问文件时需要提供正确的密码才能对文件进行正确的解密。</p>
<ol start='' >
<li>优点：保密性强，不需要在系统中储存密码。</li>
<li>缺点：编码和解密的时候需要花费时间。</li>

</ol>
</li>
<li><p>访问控制：在每个文件的FCB增加访问控制列表（ACL），该表中记录了各个用户对该文件能执行哪些操作。<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-03%20%E4%B8%8B%E5%8D%884.55.02.png" alt="/%E6%88%AA%E5%B1%8F2022-12-03%20%E4%B8%8B%E5%8D%884.55.02.png" style="zoom:25%;" /></p>
<ol start='' >
<li>精简控制表：以组为单位，标记各组用户可以对文件执行哪些操作，可以减少访问列表的体积。</li>

</ol>
</li>

</ol>
<h3 id='9）文件系统的层次结构'>（9）文件系统的层次结构</h3>
<ol start='' >
<li><p><img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-03%20%E4%B8%8B%E5%8D%885.03.16.png" alt="/%E6%88%AA%E5%B1%8F2022-12-03%20%E4%B8%8B%E5%8D%885.03.16.png" style="zoom:25%;" /></p>
</li>
<li><p>用一个例子来辅助记忆文件系统的层次结构：假设某用户请求删除文件 “D:/工作目录/学生信息.xIsx〞 的最后100条记录。</p>
<ol start='' >
<li>用户需要通过操作系统提供的接口发出上述请求一一用户接口</li>
<li>由于用户提供的是文件的存放路径，因此需要操作系统一层一层地查找目录，找到对应的目录项——文件目录系统</li>
<li>不同的用户对文件有不同的操作权限，因此为了保证安全，需要检查用户是否有访问权限——存取控制模块（存取控制验证层）</li>
<li>验证了用户的访问权限之后，需要把用户提供的“记录号”转变为对应的逻辑地址一一逻辑文件系统与文件信息缓冲区</li>
<li>知道了目标记录对应的逻辑地址后，还需要转换成实际的物理地址——物理文件系统</li>
<li>要删除这条记录，必定要对磁盘设备发出请求——设备管理程序模块</li>
<li>删除这些记录后，会有一些盘块空闲，因此要将这些空闲盘块回收——辅助分配模块</li>

</ol>
</li>

</ol>
<h3 id='10）磁盘的结构'>（10）磁盘的结构</h3>
<p><img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%889.55.39.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%889.55.39.png"/></p>
<ol start='' >
<li><p>磁盘：磁盘的表面是一些磁性物质，使用这些词性物质来记录二进制数据。</p>
</li>
<li><p>磁道：磁盘的盘面被划分成一个一个的圈，每一个圈就是一个磁道。</p>
</li>
<li><p>扇区：一个磁道又被划分为一个个扇区，每个扇区就是一个磁盘块，每个扇区的数据量相同（越往内侧的扇区的数据密度就越大)。</p>
</li>
<li><p>需要通过磁头臂把磁头移动到想要读/写的扇区所在的磁道。磁盘会转起来，让目标扇区从磁头下面划过，才能完成对扇区的读/写操作。</p>
</li>
<li><p>盘面、柱面：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.08.30.png" alt="截屏2022-12-06 上午10.08.30" style="zoom: 25%;" /></p>
<ol start='' >
<li><p>可用（柱面号，盘面号，扇区号）来定位任意一个“磁盘块”，在“文件的物理结构”小节中，我们经常提到文件数据存放在外存中的几号块，这个块号就可以转换成（柱面号，盘面号，扇区号）的地址形式。</p>
</li>
<li><p>根据地址读取数据块：</p>
<ol start='' >
<li>根据柱面号移动磁臂，让磁头指向指定柱面。</li>
<li>激活指定盘面对应的磁头。</li>
<li>磁盘旋转的过程中，指定的扇区会从磁头下面划过，这样就完成了对指定扇区的读/写。</li>

</ol>
</li>

</ol>
</li>
<li><p>磁盘的分类</p>
<ol start='' >
<li>按磁头分类：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.10.30.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.10.30.png" style="zoom:25%;" /></li>
<li>按盘片分类：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.11.08.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.11.08.png" style="zoom:25%;" /></li>

</ol>
</li>

</ol>
<h3 id='11）磁盘调度算法'>（11）磁盘调度算法</h3>
<ol start='' >
<li><p>一次读写需要的时间：</p>
<ol start='' >
<li>寻找时问（寻道时间）T：在读/写数据前，将磁头移动到指定磁道所花的时间。</li>
<li>启动磁头臂是需要时间的，假设耗时为s。</li>
<li>移动磁头也是需要时间的，假设磁头匀速移动，每跨越一个磁道耗时为 m，总共需要跨越n条磁道。</li>
<li>寻道时间<mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="14.584ex" height="1.887ex" role="img" focusable="false" viewBox="0 -677 6446.1 834.1" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.355ex;"><defs><path id="MJX-1-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-1-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-1-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-1-TEX-N-2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path><path id="MJX-1-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D460" xlink:href="#MJX-1-TEX-I-1D460"></use></g></g><g data-mml-node="mo" transform="translate(1276.4,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(2332.2,0)"><use data-c="1D460" xlink:href="#MJX-1-TEX-I-1D460"></use></g><g data-mml-node="mo" transform="translate(3023.4,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(4023.6,0)"><use data-c="1D45A" xlink:href="#MJX-1-TEX-I-1D45A"></use></g><g data-mml-node="mo" transform="translate(5123.9,0)"><use data-c="2217" xlink:href="#MJX-1-TEX-N-2217"></use></g><g data-mml-node="mi" transform="translate(5846.1,0)"><use data-c="1D45B" xlink:href="#MJX-1-TEX-I-1D45B"></use></g></g></g></svg></mjx-container><script type="math/tex">T_s=s+m*n</script>。</li>
<li>延迟时间R：通过旋转磁盘，使磁头定位到目标扇区所需要的时间。设磁盘转速为r （单位：转/秒，或转/分），则平均所需的延迟时间<mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="15.996ex" height="2.755ex" role="img" focusable="false" viewBox="0 -864.9 7070.1 1217.7" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.798ex;"><defs><path id="MJX-2-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-2-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-2-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-2-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-2-TEX-N-2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path><path id="MJX-2-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-2-TEX-I-1D445"></use></g><g data-mml-node="mo" transform="translate(1036.8,0)"><use data-c="3D" xlink:href="#MJX-2-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(2092.6,0)"><g data-mml-node="mn" transform="translate(220,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-2-TEX-N-31"></use></g><g data-mml-node="mn" transform="translate(220,-345) scale(0.707)"><use data-c="32" xlink:href="#MJX-2-TEX-N-32"></use></g><rect width="553.6" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3108.3,0)"><use data-c="2217" xlink:href="#MJX-2-TEX-N-2217"></use></g><g data-mml-node="mfrac" transform="translate(3830.6,0)"><g data-mml-node="mn" transform="translate(220,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-2-TEX-N-31"></use></g><g data-mml-node="mi" transform="translate(237.3,-345) scale(0.707)"><use data-c="1D45F" xlink:href="#MJX-2-TEX-I-1D45F"></use></g><rect width="553.6" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(4901.9,0)"><use data-c="3D" xlink:href="#MJX-2-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(5957.7,0)"><g data-mml-node="mn" transform="translate(379.5,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-2-TEX-N-31"></use></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-2-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="1D45F" xlink:href="#MJX-2-TEX-I-1D45F"></use></g></g><rect width="872.5" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><script type="math/tex">R= \frac{1}{2}*\frac{1}{r} =\frac{1}{2r}</script>（1/r就是转一圈需要的时间。找到目标扇区平均需要转半圈，因此再乘以1/2）。硬盘的典型转速为5400转/分或者7200转/分。</li>
<li>传输时间T&#39;：从磁盘读出或向磁盘写入数据所经历的时间，假设磁盘转速为r，此次读/写的字节数为b，每个磁道上的字节数为N。则：传输时间<mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="17.867ex" height="2.8ex" role="img" focusable="false" viewBox="0 -884.7 7897.3 1237.5" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.798ex;"><defs><path id="MJX-3-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-3-TEX-V-2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path><path id="MJX-3-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-3-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-3-TEX-N-2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path><path id="MJX-3-TEX-I-1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path><path id="MJX-3-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-3-TEX-I-1D447"></use></g><g data-mml-node="mo" transform="translate(793,363) scale(0.707)"><use data-c="2032" xlink:href="#MJX-3-TEX-V-2032"></use></g></g><g data-mml-node="mo" transform="translate(1315.2,0)"><use data-c="3D" xlink:href="#MJX-3-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(2371,0)"><g data-mml-node="mn" transform="translate(220,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-3-TEX-N-31"></use></g><g data-mml-node="mi" transform="translate(237.3,-345) scale(0.707)"><use data-c="1D45F" xlink:href="#MJX-3-TEX-I-1D45F"></use></g><rect width="553.6" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3386.8,0)"><use data-c="2217" xlink:href="#MJX-3-TEX-N-2217"></use></g><g data-mml-node="mfrac" transform="translate(4109,0)"><g data-mml-node="mi" transform="translate(382.3,394) scale(0.707)"><use data-c="1D44F" xlink:href="#MJX-3-TEX-I-1D44F"></use></g><g data-mml-node="mi" transform="translate(220,-345) scale(0.707)"><use data-c="1D441" xlink:href="#MJX-3-TEX-I-1D441"></use></g><rect width="827.9" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(5454.7,0)"><use data-c="3D" xlink:href="#MJX-3-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(6510.5,0)"><g data-mml-node="mi" transform="translate(541.7,394) scale(0.707)"><use data-c="1D44F" xlink:href="#MJX-3-TEX-I-1D44F"></use></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-3-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(451,0)"><use data-c="1D441" xlink:href="#MJX-3-TEX-I-1D441"></use></g></g><rect width="1146.8" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><script type="math/tex">T'=\frac{1}{r}*\frac{b}{N}=\frac{b}{rN}</script>。</li>
<li>总的平均时间<mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="18.818ex" height="2.8ex" role="img" focusable="false" viewBox="0 -884.7 8317.4 1237.5" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.798ex;"><defs><path id="MJX-4-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-4-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-4-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-4-TEX-I-1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path id="MJX-4-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-4-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-4-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path id="MJX-4-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-4-TEX-I-1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path><path id="MJX-4-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-4-TEX-I-1D44E"></use></g></g><g data-mml-node="mo" transform="translate(1318.8,0)"><use data-c="3D" xlink:href="#MJX-4-TEX-N-3D"></use></g><g data-mml-node="msub" transform="translate(2374.6,0)"><g data-mml-node="mi"><use data-c="1D447" xlink:href="#MJX-4-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><use data-c="1D460" xlink:href="#MJX-4-TEX-I-1D460"></use></g></g><g data-mml-node="mo" transform="translate(3595.5,0)"><use data-c="2B" xlink:href="#MJX-4-TEX-N-2B"></use></g><g data-mml-node="mfrac" transform="translate(4595.7,0)"><g data-mml-node="mn" transform="translate(379.5,394) scale(0.707)"><use data-c="31" xlink:href="#MJX-4-TEX-N-31"></use></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mn"><use data-c="32" xlink:href="#MJX-4-TEX-N-32"></use></g><g data-mml-node="mi" transform="translate(500,0)"><use data-c="1D45F" xlink:href="#MJX-4-TEX-I-1D45F"></use></g></g><rect width="872.5" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(5930.4,0)"><use data-c="2B" xlink:href="#MJX-4-TEX-N-2B"></use></g><g data-mml-node="mfrac" transform="translate(6930.6,0)"><g data-mml-node="mi" transform="translate(541.7,394) scale(0.707)"><use data-c="1D44F" xlink:href="#MJX-4-TEX-I-1D44F"></use></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mi"><use data-c="1D45F" xlink:href="#MJX-4-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(451,0)"><use data-c="1D441" xlink:href="#MJX-4-TEX-I-1D441"></use></g></g><rect width="1146.8" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><script type="math/tex">T_a=T_s+\frac{1}{2r}+\frac{b}{rN}</script>。</li>
<li>延迟时间和传输时间都与磁盘转速相关，且为线性相关。而转速是硬件的固有属性，因此操作系统也无法优化延退时间和传输时间。</li>

</ol>
</li>
<li><p>磁盘调度算法（移臂调度）</p>
<ol start='' >
<li><p>先来先服务（FCFS）</p>
<ol start='' >
<li>思想：根据进程请求访问磁盘的顺序进行调度。</li>
<li>举例：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.21.01.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8A%E5%8D%8810.21.01.png" style="zoom:25%;" /></li>
<li>优点：公平，如果请求访问的磁道比较集中的话算法性能尚可。</li>
<li>缺点：如果请求的磁道非常分散则性能降低。</li>

</ol>
</li>
<li><p>最短寻找时间优先（SSTF）</p>
<ol start='' >
<li>思想：SSTF算法会优先处理的磁道是与当前磁头最近的磁道。可以保证每次的寻道时间最短，但是并不能保证总的寻道时间最短（其实就是贪心算法的思想，只是选择眼前最优，但是总体未必最优）。</li>
<li>举例：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.22.02.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.22.02.png" style="zoom:25%;" /></li>
<li>优点：性能较好，平均寻道时间较短。</li>
<li>缺点：可能产生饥饿现象（原因：磁头在一个小区域内不断移动）。</li>

</ol>
</li>
<li><p>扫描算法（SCAN）</p>
<ol start='' >
<li><p>思想：SSTF 算法会产生饥饿的原因在于：磁头有可能在一个小区域内来回来去地移动。为了防止这个问题，可以规定，只有磁头移动到最外侧磁道的时候才能往内移动，移动到最内侧磁道的时候才能往外移动。这就是扫描算法 （SCAN）的思想。由于磁头移动的方式很像电梯，因此也叫电梯算法。</p>
</li>
<li><p>举例：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.24.50.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.24.50.png" style="zoom:25%;" /></p>
</li>
<li><p>优点：性能较好，平均寻道时间短，不会产生饥饿现象。</p>
</li>
<li><p>缺点：</p>
<ol start='' >
<li>只有到达最边缘的磁道才能改变方向，会产生无效的移动。</li>
<li>SCAN对各个位置的磁道响应频率不平均。</li>

</ol>
</li>
<li><p><strong>注意在做题时，磁头到达最侧边时回移到另一边、中间未读取任何东西的移动也算作移臂的移动距离，C_SCAN同理</strong></p>
</li>

</ol>
</li>
<li><p>LOOK电梯调度算法</p>
<ol start='' >
<li>思想：扫描算法（SCAN）中，只有到达最边上的磁道时才能改变磁头移动方向，事实上，处理了184号磁道的访问请求之后就不需要再往右移动磁头了。LOOK 调度算法就是为了解决这个问题，如果在磁头移动方向上己经没有别的请求，就可以立即改变磁头移动方向。边移动边观察，因此叫LOOK。</li>
<li>举例：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.27.06.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.27.06.png" style="zoom:25%;" /></li>
<li>优点：相比SCAN不需要每次都移动到最外侧才改变方向，是寻道时间缩短。</li>

</ol>
</li>
<li><p>循环扫描算法（C_SCAN）</p>
<ol start='' >
<li>思想：SCAN算法对于各个位置磁道的响应频率不平均，而 C-SCAN 算法就是为了解决这个问题。规定只有磁头朝某个特定方向移动时才处理磁道访问请求，而返回时直接快速移动至起始端而不处理任何请求。</li>
<li>举例：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.28.51.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.28.51.png" style="zoom:25%;" /></li>
<li>优点：相比SCAN，对于各个位置的磁道响应频率很平均。</li>
<li>缺点：磁头也只有到达边缘才会返回，而且是直接返回边缘，实际平均访问长度增大了。</li>

</ol>
</li>
<li><p>C_LOOK算法</p>
<ol start='' >
<li>思想：C-SCAN 算法的主要缺点是只有到达最边上的磁道时才能改变磁头移动方向，并且磁头返回时不一定需要返回到最边缘的磁道上。C-LOOK 算法就是为了解决这个问题。如果磁头移动的方向上已经没有磁道访问请求了，就可以立即让磁头返回，并且磁头只需要返回到有磁道访问请求的位置即可。</li>
<li>举例：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.31.31.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%882.31.31.png" style="zoom:25%;" /></li>
<li>优点：相比C-SCAN算法不需要每次都移动到最边缘，使寻道时间进一步缩短。</li>
<li><font color=red>如果题目中无特别说明，则默认SCAN为LOOK，C-SCAN为C-LOOK（存疑，gjd标准未知）</font></li>
<li><font color=green>这里SCAN算法、C_SCAN算法都是必须要到达磁道尽头才可以调转方向，LOOK和C_LOOK都是只需要这个方向上没有请求就可以。</font></li>

</ol>
</li>
<li><p>N-step——SCAN算法</p>
<ol start='' >
<li>思想：把磁盘 I/O 请求队列分成长度为N的子队列，按照FIFO处理每一个子队列，每个子队列内部使用扫描算法。在处理一个队列时，新请求必须添加到<strong>其他</strong>某个队列中，处理完一个子队列后再服务下一个队列，如果在扫描的最后剩下的请求数小于 N，则它们全部将在下一次扫描时处理。</li>
<li>当 <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="7.791ex" height="1.57ex" role="img" focusable="false" viewBox="0 -683 3443.6 694" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-5-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path id="MJX-5-TEX-N-2192" d="M56 237T56 250T70 270H835Q719 357 692 493Q692 494 692 496T691 499Q691 511 708 511H711Q720 511 723 510T729 506T732 497T735 481T743 456Q765 389 816 336T935 261Q944 258 944 250Q944 244 939 241T915 231T877 212Q836 186 806 152T761 85T740 35T732 4Q730 -6 727 -8T711 -11Q691 -11 691 0Q691 7 696 25Q728 151 835 230H70Q56 237 56 250Z"></path><path id="MJX-5-TEX-N-221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D441" xlink:href="#MJX-5-TEX-I-1D441"></use></g><g data-mml-node="mo" transform="translate(1165.8,0)"><use data-c="2192" xlink:href="#MJX-5-TEX-N-2192"></use></g><g data-mml-node="mi" transform="translate(2443.6,0)"><use data-c="221E" xlink:href="#MJX-5-TEX-N-221E"></use></g></g></g></svg></mjx-container><script type="math/tex">N \rightarrow \infty</script>时，N-step-SCAN 的性能接近 SCAN。</li>
<li>当 <mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.157ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 2721.6 765" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.186ex;"><defs><path id="MJX-6-TEX-I-1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path><path id="MJX-6-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-6-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D441" xlink:href="#MJX-6-TEX-I-1D441"></use></g><g data-mml-node="mo" transform="translate(1165.8,0)"><use data-c="3D" xlink:href="#MJX-6-TEX-N-3D"></use></g><g data-mml-node="mn" transform="translate(2221.6,0)"><use data-c="31" xlink:href="#MJX-6-TEX-N-31"></use></g></g></g></svg></mjx-container><script type="math/tex">N = 1</script>时，实际上是FIFO。</li>

</ol>
</li>

</ol>
</li>

</ol>
<h3 id='12）减少磁盘延迟'>（12）减少磁盘延迟</h3>
<ol start='' >
<li><p>磁头只能朝一个方向移动，由于磁头在读取完一个扇区的数据以后需要一段时间处理，而这段时间磁头会一直保持旋转，因此磁头在连续读取在物理上相邻的扇区时就会出现延迟。</p>
</li>
<li><p>减少延迟时间的方法：交替编号</p>
<p>思想：采用交替编号的策略，让逻辑上相邻的扇区在物理上有一定的间隔，可以使连续读取逻辑扇区是的延迟减小。</p>
</li>
<li><p>磁盘地址结构的设计</p>
<ol start='' >
<li><p>思考：为什么？磁盘的物理地址是（柱面号，盘面号，扇区号）而不是（盘面号，桂面号，扇区号）</p>
</li>
<li><p>原因：因为磁盘是多个磁盘堆叠起来，而每个磁盘都有一个磁头，此时如果读完一个磁盘在继续读取，如果继续读取的数据仍在同一柱面，则磁头是不需要移动的。</p>
</li>
<li><p>举例：假设某磁盘有8个柱面/磁道（假设最内侧柱面/磁道号为0）
4个盘面，8个扇区。则可用3个二进制位表示柱面，2个二进制位表示盘面，3个二进制位表示扇区。若物理地址结构是（盘面号，柱面号，扇区号），且需要连续读取物理地址 (00,000,000）～(00,001,111）的扇区：(00,000,000） ~ （00,000,111） 转两圈可读完之后再读取物理地址相邻的区域，即(00, 001, 000)~（00,001, 111），需要启动磁头臂，将磁头移动到下一个磁道。</p>
<p>假设某磁盘有8个柱面/磁道（假设最内侧柱面/磁道号为0）4个盘面，8个扇区。则可用3个二进制位表示柱面，2个二进制位表示盘面，3个二进制位表示扇区若物理地址结构是（柱面号，盘面号，扇区号)，且需要连续读取物理地址 (000, 00,000）~ （000,01,111） 的扇区：(000, 00, 000）~（000,00,111） 由盘面o的磁头读入数据之后再读取物理地址相邻的区域，即(000, 01, 000)~（090,01,111），由于柱面号/磁道号相同，只是盘面号不同，因此不需要移动磁头譬。只需要激活相邻盘面的磁头即可。</p>
</li>

</ol>
</li>
<li><p>减少延迟的方法：错位命名</p>
<p>若相邻的盘面相对位置相同处扇区编号相同，则有如下情况：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%883.24.27.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%883.24.27.png" style="zoom:25%;" /></p>
<p>所以这对需要将不同盘面的扇区进行错位的命名，情况如下：<img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%883.26.12.png" alt="/%E6%88%AA%E5%B1%8F2022-12-06%20%E4%B8%8B%E5%8D%883.26.12.png" style="zoom:25%;" /></p>
</li>

</ol>
<h3 id='13）磁盘的管理'>（13）磁盘的管理</h3>
<ol start='' >
<li><p>磁盘初始化</p>
<ol start='' >
<li>进行低级格式化（物理格式化），将磁盘的各个磁道划分为扇区。一个扇区通常可分为 头、数据区域（如512B大小）、尾三个部分组成。管理扇区所需要的各种数据结构一般存放在头、尾两个部分，包括扇区校验码（如奇偶校验、CRC循环冗余校验码等，校验码用于校验扇区中的数据是否发生错误。</li>
<li>将磁盘分区，每个分区由若干柱面组成（即分为我们熟悉的C盘、D盘、E盘）。</li>
<li>进行逻辑格式化，创建文件系统。包括创建文件系统的根目录、初始化存储空间管理所用的数据结构（如 位示图、空闲分区表）。</li>

</ol>
</li>
<li><p>引导块：计算机开机时需要进行一系列初始化的工作，这些初始化工作通过初始化程序（自举程序）完成。</p>
<ol start='' >
<li>初始化程序可以放在ROM中，在出厂时就集成在主板上，但是ROM不支持数据更改，不能更新自举程序。</li>
<li>ROM只存放很小的自举装入程序，开机时先运行自举装入程序，通过执行该程序找到引导块，并将完整的自举程序读入内存，完成初始化。</li>
<li>完整的自举程序存放在磁盘的启动块（即引导块/启动分区），启动块位于磁盘的固定位置，拥有启动分区的磁盘被称为启动磁盘或系统磁盘（一般为C盘）。</li>

</ol>
</li>
<li><p>坏块：</p>
<ol start='' >
<li>概念：坏了、无法正常使用的扇区就是“坏块”。这属于硬件故障，操作系统是无法修复的。应该将坏块标记出来，以免错误地使用到它。</li>
<li>对于简单的磁盘，可以在逻辑格式化/建立文件系统时对整个磁盘进行坏块检查，标明哪些是坏的。</li>
<li>对于复杂的磁盘，磁盘控制器（磁盘设备内部的一个硬件部件）会维护一个坏块链表，在磁盘出厂前进行低级格式化 （物理格式化）时就将坏块链进行初始化。</li>
<li>会保留一些“备用扇区〞，用于替换坏块。这种方案称为扇区备用。且这种处理方式中，坏块对操作系统透明（OS不可知）。</li>

</ol>
</li>

</ol>
<h3 id='14）unix三级索引储存技术'>（14）Unix三级索引储存技术</h3>
<ol start='' >
<li><p>在文件系统中，文件的存储设备通常划分为若干个大小相等的物理块，每块长为512或1024字节。文件的物理结构是指文件在存储设备上的存储方法，常用的文件物理结构有：连续文件、串联文件和索引文件三种。存储空间会被划分成n个物理块，在索引文件中，一个文件会被放入不同的物理块，这时需要索引表指出一个文件分别被拆分存在哪个块，所以索引表里存的是文件碎片的地址。在多级(间接索引)技术中，在由索引表指出的物理块中存放的不是<strong>文件存储位置</strong>而是存放文件信息的<strong>物理块地址</strong>（即<strong>索引表里存索引表</strong>…）。</p>
</li>
<li><p>Unix系统三级索引：</p>
<ol start='' >
<li><p>为了使一张索引表（一个数组）能完整存下一个文件，在Unix系统中，文件的物理结构采用索引方式。定义有一个索引节点字符数组（一张索引表），inode 规定了15 个索引项，每项 4KB：</p>
<ol start='' >
<li>直接索引：前 12 项存放文件信息的磁盘块号</li>
<li>一次间接索引：第 13 项指向一个物理块</li>
<li>二次间接索引：第 14 项指向一个物理块</li>
<li>三次间接索引：第 15 项指向一个物理块</li>
<li>ext2 中，每个物理块存放 1024B，所以上面右图最多存放(12KB + 256KB + 256^2KB+256^3KB)</li>

</ol>
</li>
<li><p>长度不超过 12 个磁盘块的占 80%，只有超过 12 个磁盘块才使用简介索引。</p>
</li>
<li><p>多级索引例子（重要）：注意是从 0-128 一共 129 项。</p>
</li>
<li><p>在这里，要注意到<strong>一次、二次、三次间接索引在inode文件中都只占一个地址，而一个地址指向一个间接索引表，所以每个inode只能各有一串一次、二次、三次间接索引表。</strong></p>
</li>
<li><p><img src="./assets/OS_b_images/%E6%88%AA%E5%B1%8F2023-02-20%20%E4%B8%8B%E5%8D%887.59.56.png" alt="截屏2023-02-20 下午7.59.56" style="zoom:25%;" /></p>
</li>
<li><p>注意这里一次/二次/三次间接盘块指的是最底层的、储存文件数据的盘块，而不是储存索引的中间盘块。</p>
</li>

</ol>
</li>

</ol>
</body>
</html>