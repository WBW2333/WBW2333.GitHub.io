<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>计网-04-网络层</title>
</head>
<body><h1 id='计网-04-网络层'>计网-04-网络层</h1>
<h2 id='一概述和功能'>一、概述和功能</h2>
<h3 id='1）概述'>（1）概述</h3>
<p>网络层主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务，网络层传输单位是数据报。</p>
<p>网络层的设计思路就是向上只提供简单灵活的、无连接的、尽最大努力交付的数据报服务。也就是说传输的分组可能出错、丢失、重复、失序或超时等，但是这能是的网络中的路由器尽量简单和价格低廉，是的网络成本大大降低，运行灵活，适应多种应用。</p>
<h3 id='2）功能'>（2）功能</h3>
<ol>
<li><p>路由与转发</p>
<ol>
<li>主要完成路由选择和分组转发。</li>
<li>路由选择：根据复杂的分布式算法，根据从相邻路由器所得到的网络拓扑的变化情况动态的改变所选择的路由。</li>
<li>分组转发：指路由器根据转发表将用户的IP数据报从合适的端口转发出去。</li>

</ol>
</li>
<li><p>异构网络互联</p>
<ol>
<li>将两个以上的计算机网络通过一定方法和一些中间设备相互连接起来已构成更大的网络系统。</li>
<li>使用物理层设备扩展网络只是把一个网络变大了，从网络层的角度看并不是连接了不同的网络。</li>

</ol>
</li>
<li><p>拥塞控制</p>
<ol>
<li><p>在通信子网中，因出现过量分组引起的网络性能下降的现象称为拥塞。</p>
</li>
<li><p>拥塞控制方法有</p>
<ol>
<li>开环控制：在设计网络时事先将有关发生拥塞的因素考虑周到，使得网络在工作时不产生拥塞，是一种静态的预防方法。</li>
<li>闭环控制：事先不考虑有关发生拥塞的各种因素，实时监测那里发生拥塞然后调整网络运行来解决拥塞。</li>

</ol>
</li>

</ol>
</li>

</ol>
<p>&nbsp;</p>
<h2 id='二路由算法'>二、路由算法</h2>
<h3 id='1）静态路由和动态路由'>（1）静态路由和动态路由</h3>
<ol>
<li><p>静态路由算法/非自适应路由算法</p>
<ol>
<li>由网络管理员手工配置的路由信息。当网络的拓扑结构或链路的状态发生变化时，网络管理员需要手工去修改路由表中相关的静态路由信息。</li>
<li>不能及时适应网络状态的变化，对于简单的小型网络，可以采用静态路由。</li>

</ol>
</li>
<li><p>动态路由算法/自适应路由算法</p>
<ol>
<li>指路由器上的路由表项是通过相互连接的路由器之间彼此交换信息，然后按照一定的算法优化出来的，而这些路由信息会在一定时间间隙里不断更新，以适应不断变化的网络，随时获得最优的寻路效果。</li>

</ol>
</li>
<li><p>静态路由算法的特点是简便和开销较小，在拓扑变化不大的小网络中运行效果很好。</p>
</li>
<li><p>动态路由算法能改善网络的性能并有助于流量控制；但算法复杂，会增加网络的负担，有时因对动态变化的反应太快而引起振荡，或反应太慢而影响网络路由的一致性，因此要仔细设计动态路由算法以发挥其优势。</p>
</li>

</ol>
<h3 id='2）距离-向量路由算法'>（2）距离-向量路由算法</h3>
<ol>
<li><p>距离-向量路由算法，要求网络中的每一个路由器都维护从他自己到其他每一个目的网络的唯一最佳距离记录，是因特网的协议标准，最大优点是简单，最经典的是RIP算法。</p>
</li>
<li><p>距离：通常用跳数表示距离，即从源端口到目的端口所经过的路由器个数，经过一个路由器跳数+1。从一路由器到直接连接的网络距离为1。<strong>RIP允许一条路最多包含15个路由器，因此距离16表示网络不可到达</strong>。</p>
</li>
<li><p>RIP算法通过在路由器之间交换路由表实现距离向量</p>
<ol>
<li>路由器仅和相邻路由器交换信息。</li>
<li>路由器交换信息是自己的路由表</li>
<li>路由器刚开始工作时只知道直接连接的网络的距离（为1）。</li>
<li>每个路由器也只和数目有限的相邻路由器交换并更新路由信息。</li>
<li>经过若干次更新后，所有路由器最终都会知道到达本系统下任何网络的最短距离和下一跳路由器地址。</li>

</ol>
</li>
<li><p>更新路由表原则</p>
<ol>
<li>获知一条新的路由，在本节点的路由表中不存在，加入新的路由。</li>
<li>获知的路由中有到达某个目的地的路由，该路由比现有路由更短，则用新路由替换旧路由。</li>

</ol>
</li>

</ol>
<h3 id='3）链路状态路由算法'>（3）链路状态路由算法</h3>
<ol>
<li></li>

</ol>
<h2 id='三ipv4'>三、IPv4</h2>
<h3 id='1）ipv4分组'>（1）IPv4分组</h3>
<ol>
<li><p>IPv4是目前最普遍使用的版本，IP协议定义数据传输的最基本单元——IP分组及其确切的数据格式。</p>
</li>
<li><p>IP数据报<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8A%E5%8D%8810.54.21.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 上午10.54.21"></p>
<ol>
<li>版本：指IP协议的版本，目前广泛使用的版本是4.</li>
<li>首部长度：占4位，<em>单位是4B</em>，即用4位表示0～60B的长度，最常用的是20B。</li>
<li>总长度：占16位，指首部和数据之和的长度，<em>单位是B</em>，因此数据报最长为65535B。</li>
<li>标识：占16位，标识字段表示分组的顺序，以能够正确重装成原来的数据报，同一数据报的分片用同一标识。</li>
<li>标志：占3位，最低位是MF，MF=1表示后续还有分片，MF=0表示最后一个分片。中间一位是DF，只有DF=0时才能分片。</li>
<li>片偏移：占13位，指出较长的分组在分片后某片在原分组中的相对位置。<em>片偏移以8B为单位</em>，除开最后一个片外所有片长度必须为8B的整数倍。</li>
<li>生存时间（TTL）：占8位，IP分组的保质期，经过一个路由器-1，变成0则丢弃。</li>
<li>协议：占8位，指出数据部分的协议。</li>
<li>首部检验和：占16位，只检验首部的。</li>
<li>源地址字段：占4B，标识发送方的IP地址。</li>
<li>目的地址字段：占4B，标识接收方的IP地址。</li>

</ol>
</li>
<li><p>IP数据报分片</p>
<ol>
<li>一个数据链路层的数据报会有最大传送单元（MTU），因此IP数据报的大小可能会超过MTU，此时就需要将IP数据报分装到多个小的数据报中，这些较小的数据报就叫片。</li>
<li>IP数据报能否分片和MF、DF标识位相关，分片后在原数据的位置和片偏移相关。</li>
<li>如：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%883.11.22.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午3.11.22"></li>

</ol>
</li>

</ol>
<h3 id='2）ipv4地址'>（2）IPv4地址</h3>
<ol>
<li><p>IP地址是连接到因特网上的每台主机或路由器都分配的一个32比特的全球唯一标识符，即IP地址。</p>
</li>
<li><p>分类的IP地址：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%883.28.06.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午3.28.06"></p>
</li>
<li><p>无论哪类IP地址都由网络号和主机号两部分组成，即IP地址::={&lt;网络号&gt;,&lt;主机号&gt;}。</p>
</li>
<li><p>特殊IP地址，不用做主机地址：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%883.36.35.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午3.36.35"></p>
</li>
<li><p>IP地址范围：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%883.43.36.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午3.43.36"></p>
</li>
<li><p>IP地址的特点</p>
<ol>
<li><p>每个IP地址都由网络号和主机号两部分组成，因此IP地址是一种分等级的地址结构。分等级的好处是：</p>
<ol>
<li>IP 地址管理机构在分配IP地址时只分配网络号，而主机号则由得到该类网络的单位自行分配，方便了IP地址的管理。</li>
<li>路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目标主机号)，从而减小了路由表所占的存储空间。</li>

</ol>
</li>
<li><p>IP地址是标志一台主机（或路由器）和一条链路的接口。</p>
</li>
<li><p>用转发器或桥接器（网桥等）连接的若干LAN仍然是同一个网络（同一个广播域），因此该LAN中所有主机的IP地址的网络号必须相同，但主机号必须不同。</p>
</li>
<li><p>在IP地址中，所有分配到网络号的网络（无论是LAN 还是 WAN）都是平等的。</p>
</li>
<li><p>在同一个局域网上的主机或路由器的IP地址中的网络号必须是一样的。路由器总是具有两个或两个以上的IP地址，路由器的每个端口都有一个不同网络号的I地址。</p>
</li>

</ol>
</li>

</ol>
<h3 id='3）网络地址转换nat）'>（3）网络地址转换（NAT）</h3>
<ol>
<li><p>网络地址转换（NAT）：指通过将专用网络地址转换为公用地址从而对外隐藏内部的IP地址。</p>
</li>
<li><p>NAT技术使得整个专用网只需要一个全球IP地址就可以与因特网连通，所以大大降低了IP地址的消耗。同时隐藏了内部的网络结构，从而降低了内部网络受到攻击的风险。</p>
</li>
<li><p>使用NAT需要在专用网连接到因特网的路由器上安装NAT软件，安装了NAT软件的路由器叫NAT路由器，它至少有一个有效的外部全球IP地址。</p>
</li>
<li><p>为了网络安全而划分出部分IP地址作为私有地址IP地址，私有地址只用于LAN，不用与WAN连接（因此私有IP地址不能直接用于Internet，必须通过网关转换），私有IP地址网段有：</p>
<ol>
<li>A类：1个A类网段，即10.0.0.0～10.255.255.255。</li>
<li>B类：16个B类网段，即172.16.0.0～172.31.255.255。</li>
<li>C类：256个C类网段，即192.168.0.0～192.168.255.255。</li>

</ol>
</li>

</ol>
<h3 id='4）子网划分'>（4）子网划分</h3>
<ol>
<li><p>两级IP地址的缺点</p>
<ol>
<li>IP地址的空间利用率很低。</li>
<li>给每个物理网络分配一个网络号会使路由表太大而使网络性能变坏。</li>
<li>两级的IP地址不够灵活。</li>

</ol>
</li>
<li><p>从1985年起，在IP地址中增加一个“子网号字段”，使两级IP地址变成了3级IP地址，称为子网划分。</p>
</li>
<li><p>子网划分纯属单位内部的工作，对外仍旧表现为没划分的网络。</p>
</li>
<li><p>从主机号划分若干比特作为网段号，使得三级IP地址为{&lt;网络号&gt;，&lt;网段号&gt;，&lt;主机号&gt;}。<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%884.26.06.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午4.26.06"></p>
</li>
<li><p>主机号不能全0全1，但是子网号可能可以为全0全1。</p>
</li>

</ol>
<h3 id='5）子网掩码'>（5）子网掩码</h3>
<ol>
<li>为了告诉主机或路由器对一个A类、B类、C类网络进行了子网划分，使用子网掩码来表达对原网络中主机号的借位。</li>
<li>子网掩码是一个与IP地址相对应的、长32bit的二进制串，它由一串1和跟随的一串0组成。其中，1对应于IP地址中的网络号及子网号，而0对应于主机号。计算机只需将IP地址和其对
应的子网掩码逐位 “与”运算，就可得出相应子网的网络地址。</li>
<li>现在的因特网标准规定：所有的网络都必须使用子网掩码，如果一个网络未划分子网，那么就采用默认子网掩码。</li>
<li>A、B、C类地址的默认子网掩码分别为 255.0.0.0、255.255.0.0、255.255.255.0。</li>

</ol>
<h3 id='6）无分类编址cidr'>（6）无分类编址CIDR</h3>
<ol>
<li><p>无分类域间路由选择CIDR是在变长子网掩码的基础上提出的一种消除传统A、B、C类网络划分，并可以在软件的支持下实现超网构造的一种IP地址的划分方法。</p>
</li>
<li><p>CIDR消除了传统的ABC类地址和子网的概念，引入“网络前缀”来代替子网，网络前缀的位数不是固定的，可以任意选取，IP::={&lt;网络前缀&gt;，&lt;主机号&gt;}。<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%885.33.13.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午5.33.13"></p>
</li>
<li><p>CIDR虽然不使用子网，但是仍旧可以在分配到的CIDR地址块中划分子网，通过从主机号中再借用几位即可。CIDR也保留了子网掩码，仍旧通过和前n位全1的掩码取与计算。<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8A%E5%8D%888.32.22.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 上午8.32.22"></p>
</li>
<li><p>超网</p>
<ol>
<li>将多个子网聚合成一个较大的子网，叫构成超网，或路由聚合。</li>
<li>方法：将网络前缀缩短（所有网络地址取交集）</li>
<li>路由聚合使得路由表中的一个项目可以表示多个原始的传统地址，有利于减少路由器之间的信息交换，提高网络性能。</li>

</ol>
</li>
<li><p>最长前缀匹配：使用CIDR时，查找路由表可能得到几个匹配结果，应该选择有最长网络前缀的路由。前缀越长，地址快越小，路由越具体。</p>
</li>

</ol>
<h3 id='7）网络层分组转发'>（7）网络层分组转发</h3>
<ol>
<li><p>分组到达路由器后，路由器根据目的IP地址的网络前缀来查找转发表，因此在转发表中每条路由需要包括：（目的网络，下一跳地址）。</p>
</li>
<li><p>转发表中可以有两种特殊路由</p>
<ol>
<li>主机路由：对特定目的主机的IP地址专门指明路由，网络前缀是32位，这样子网掩码就没有意义了，但这个特殊的前缀可以用在转发表中。</li>
<li>默认路由：用特殊前缀0.0.0.0/0表示默认路由，全0编码和任何目的地址都可以匹配上，只要目的网络是其他网络则一律选择默认路由。</li>

</ol>
</li>
<li><p>路由器执行分组转发算法的步骤</p>
<ol>
<li>从收到的IP分组的首部提取目的主机的IP地址D（即目的地址）。</li>
<li>若查找到特定主机路由（目的地址为D），就按照这条路由的下一跳转发分组；否则从转发表中的下一条（即按前缀长度的顺序）开始检查，执行步骤3。</li>
<li>将这一行的子网掩码与目的地址D进行按位与运算。若运算结果与本行的前缀匹配，则查找结束，按照“下一跳”指出的进行处理（或者直接交付本网络上的目的主机，或通过指定接口发送到下一跳路由器)。否则，若转发表还有下一行，则对下一行进行检查，重新执行步骤3；否则，执行步骤4。</li>
<li>若转发表中有一个默认路由，则把分组传送给默认路由；否则，报告转发分组出错。</li>

</ol>
</li>
<li><p><em>得到下一跳路由器的IP地址后，不是将该地址填入数据报，而是将IP地址换成MAC地址并放入MAC帧首部，然后根据MAC地址找到下一跳路由器。</em></p>
</li>

</ol>
<p>&nbsp;</p>
<h2 id='四arpdhcpicmp'>四、ARP、DHCP、ICMP</h2>
<h3 id='1）ip地址与mac地址'>（1）IP地址与MAC地址</h3>
<ol>
<li>IP地址是网络层及以上的地址，MAC地址是数据链路层使用的地址，IP地址放在IP数据报的首部，MAC地址放在MAC帧的首部。数据链路层是看不到封装的MAC帧中的IP地址的。</li>
<li>IP网络不能直接广播MAC地址来完成跨网络的发送，因此在网络层和网络之间传递只能通过IP地址通信，而在一个LAN中，需要通过MAC地址来寻找目的主机。即在路由器之间转发使用IP地址，到达目标LAN中改用MAC地址以广播的方式寻址，这样可以提高路由选择的效率。</li>
<li>在路由器转发过程中，IP分组在每个路由器中都会被解封装和重新封装，MAC帧的首部会不断变化，这也决定了不能用MAC地址跨网络通信。</li>

</ol>
<h3 id='2）地址解析协议arp）'>（2）地址解析协议（ARP）</h3>
<ol>
<li><p>在实际的网络链路上传输数据帧时最终必须使用MAC地址，因此需要ARP实现IP地址到MAC地址的映射。</p>
</li>
<li><p>每个主机都有一个ARP高速缓存，存放本局域网上个主机和路由器的IP地址到MAC地址的映射，称为ARP表，并通过ARP来维护这个表。</p>
</li>
<li><p>ARP使用过程：</p>
<ol>
<li>检查ARP高速缓存，有对应表项则写入MAC帧。</li>
<li>没有则用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装并<strong>广播ARP请求分组</strong>，同一局域网中所有主机都能收到该请求。</li>
<li>目的主机收到请求后就会向源主机<strong>单播一个ARP响应分组</strong>，源主机收到后将此映射写入ARP缓存（10-20min更新一次）。</li>
<li>ARP解决同一局域网上的主机或路由器的IP地址和MAC地址的映射问题，如果目的主机和源主机不在同一个局域网上，那就要通过ARP找到本地局域网上的路由器的硬件地址，然后把分组转发到路由器让路由器转发给下一个网络。</li>

</ol>
</li>
<li><p>ARP的4种典型情况：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8A%E5%8D%8810.05.59.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 上午10.05.59"></p>
<ol>
<li>发送方是主机H1，要把IP数据报发送到本网络上的另一台主机H2，H1在网1用ARP找到目的主机H2的硬件地址。</li>
<li>发送方是主机H1，要把IP数据报发送到另一个网络上的一台主机H3，H1用ARP找到与网1连接的路由器R1的硬件地址，剩下的工作由R1来完成。</li>
<li>发送方是路由器R1，要把IP数据报转发到与 R1连接的网2上的一台主机H3，R1在网2用 ARP找到目的主机H3的硬件地址。</li>
<li>发送方是路由器R1，要把IP数据报转发到网3上的一台主机H4。这时R1在网2用ARP找到与网2连接的路由器R2的硬件地址，剩下的工作由R2来完成。</li>

</ol>
</li>
<li><p>从IP地址到MAC地址的解析是自动进行的，主机的用户并不知道这种地址解析过程。</p>
</li>
<li><p><em>注意这里路由器发送到路由器也是要经过一次ARP协议的</em></p>
</li>

</ol>
<h3 id='3）动态主机配置协议dhcp）'>（3）动态主机配置协议（DHCP）</h3>
<ol>
<li><p>DHCP常用于给主机动态分配IP地址，DHCP是应用层协议，使用客户/服务器方式，客户端和服务端通过广播方式进行交互，基于UDP。</p>
</li>
<li><p>DHCP提供即插即用联网的机制，主机可以从服务器动态获取IP地址、子网掩码、默认网关、DNS服务器名称与IP地址，允许地址重用，支持移动用户加入网络，支持在用地址续租。</p>
</li>
<li><p>DHCP服务器和客户端交互过程：</p>
<ol>
<li>DHCP客户机<strong>广播</strong>“DHCP发现” 消息，试图找到网络中的DHICP 服务器，以便从DHCP服务器获得一个IP地址，源地址为 0.0.0.0，目的地址为 255.255.255.255。</li>
<li>DHCP服务器收到“DHCP发现”消息后，<strong>广播</strong>“DHCP提供”消息，其中包括提供给DHCP客户机的IP地址，源地址为DHCP服务器地址，目的地址为 255.255.255.255。</li>
<li>DHCP客户机收到“DHCP提供”消息，如果接受该地址，那么就<strong>广播</strong>“DHCP请求”消息向DHCP服务器请求提供IP地址，源地址为0.0.0.0，目的地址为 255.255.255.255。</li>
<li>DHCP服务器<strong>广播</strong>“DHCP确认”消息，将IP地址分配给DHCP客户机，源地址为DHCP服务器地址，目的地址为 255.255.255.255。</li>
<li><img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8A%E5%8D%8810.25.55.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 上午10.25.55"></li>

</ol>
</li>
<li><p>客户机发出DHCP发现消息时，可能会收到多个应答消息，此时客户机只会选择一个，通常是选择第一个收到的。</p>
</li>
<li><p>DHCP服务器分配的IP地址是临时的，因此客户只能在一段时间内使用地址，DHCP称这段时间为租用期。</p>
</li>
<li><p>DHCP的服务器和客户机要通过广播进行交互，因为交互过程开始客户机不知道服务器的位置，交互过程客户机缺少IP地址，因此需要通过广播交互。</p>
</li>

</ol>
<h3 id='4）网络控制报文协议icmp）'>（4）网络控制报文协议（ICMP）</h3>
<ol>
<li><p>为了提高IP数据报交付成功的机会，在网络层使用ICMP来让主机或路由器报告差错和异常情况。</p>
</li>
<li><p>ICMP报文作为IP层数据报的数据，加上数据报首部，组成IP数据报发送出去。</p>
</li>
<li><p>ICMP是网络层协议。</p>
</li>
<li><p>ICMP报文有两种：</p>
<ol>
<li>ICMP差错报文</li>
<li>ICMP询问报文</li>

</ol>
</li>
<li><p>ICMP差错报告报文的5种类型：</p>
<ol>
<li>终点不可达：当路由器或主机不能交付数据报时，就向源点发送终点不可达报文——无法交付。</li>
<li>源点抑制（现在已不使用）：当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使源点知道应当把数据报的发送速率放慢——拥塞丢数据。</li>
<li>时间超过：当路由器收到生存时间（TTL）为零的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把己收到的数据报片都丢弃，并向源点发送时间超过报文——TTL=0.</li>
<li>参数问题：当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文——首部字段有问题。</li>
<li>改变路由（重定向）：路由器把改变路由报文发送给主机，让主机知道下次应将数据报发
送给另外的路由器——可通过更好的路由。</li>

</ol>
</li>
<li><p>ICMP差错报告报文数据字段：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8A%E5%8D%8810.39.13.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 上午10.39.13"></p>
</li>
<li><p>不发送ICMP差错报文的情况：</p>
<ol>
<li>对ICMP差错报告报文不再发送ICMP差错报告报文。</li>
<li>对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文。</li>
<li>对具有组播地址的数据报都不发送ICMP差错报告报文。</li>
<li>对具有特殊地址（如127.0.0.0 或 0.0.0.0）的数据报不发送ICMP差错报告报文。</li>

</ol>
</li>
<li><p>ICMP询问报文：</p>
<ol>
<li>回送请求和回答报文：主机或路由器向特定目的主机发出的询问，收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文。测试目的站是否可达以及了解其相关状态。</li>
<li>时间戳请求和回答报文：请某个主机或路由器回答当前的日期和时间。用来进行时钟同步和测量时间。</li>
<li>掩码地址请求和回答报文</li>
<li>路由器询问和通告报文</li>

</ol>
</li>
<li><p>ICMP的应用</p>
<ol>
<li>分组网间探测PING：测试两个主机之间的连通性，使用ICMP回送请求和回答报文。</li>
<li>Traceroute：跟踪一个分组从源点到终点的路径，使用了ICMP时间超过差错报告报文。</li>

</ol>
</li>

</ol>
<p>&nbsp;</p>
<h2 id='五ipv6'>五、IPv6</h2>
<h3 id='1）ipv6的特性'>（1）IPv6的特性</h3>
<ol>
<li><p>无论是CIDR还是NAT，都只是延长了IPv4的耗尽时间，只有IPV6从根本上解决了IP地址耗尽的问题。</p>
</li>
<li><p>IPv6数据报格式<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8A%E5%8D%8810.55.43.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 上午10.55.43"><img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8A%E5%8D%8810.57.35.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 上午10.57.35"></p>
<ol>
<li>版本：指明协议版本，总是6</li>
<li>优先级：区分数据报的类别和优先级。</li>
<li>流标签：“流”是从特定源点到特定终点的一系列数据报。所有属于同一个流的数据报都具有同样的流标签。</li>
<li>有戏载荷长度：有效载荷部分的长度。</li>
<li>下一个首部：标识下一个扩展首部或上层协议首部。</li>
<li>跳数限制：TTL</li>
<li>源。目的地址：注意这里地址有128位，IPv4只有32位。</li>

</ol>
</li>
<li><p>IPv6的变化和特性</p>
<ol>
<li>IPv6将地址从32位扩大到128位。</li>
<li>IPv6将IPv4的校验和字段彻底删除，以减少每条的处理时间。</li>
<li>IPv6将Ipv4的可选字段移出首部，变成了扩展首部，成为灵活的首部格式。</li>
<li>IPv6支持即插即用，不需要DHCP协议。</li>
<li>IPv6首部长度必须是8B的整数倍，IPv4首部是4B的整数倍。</li>
<li>IPv6只能在主机处分片，IPv4可以在路由器和主机处分片。</li>
<li>ICMPv6：附加报文类型“分组过大”。</li>
<li>IPv6支持资源的预分配，支持实时视像等，保证一定的带宽和时延的应用。</li>
<li>IPv6取消了协议字段，改成下一个首部字段。</li>
<li>Ipv6取消了总长度字段，改用有效荷载长度字段。</li>
<li>IPv6取消了服务类型字段。</li>

</ol>
</li>

</ol>
<h3 id='2）ipv6地址'>（2）IPv6地址</h3>
<ol>
<li><p>IPv6使用冒号十六进制记法，把地址中的每4位用一个16进制数标识，并用冒号分割每16位，如AAAA:BBBB:CCCC:DDDD:0101:2323:4545:7878。</p>
</li>
<li><p>当在16位域中开头有一些0的时候，可以使用缩写写法，但一个16位域中至少有一个数字：AAAA:000B:000C:DDDD:0000:0023:4545:7878=AAAA:B:C:DDDD:0:23:4545:7878。</p>
</li>
<li><p>当有相继的0值域时，还可以进一步缩写，这些域可以用双冒号缩写（::），且<strong>双冒号只能出现一次</strong>，AAAA:0000:0000:0000:0000:0003:4545:7878=AAAA::23:4545:7878。</p>
</li>
<li><p>IPv6基本地址类型</p>
<ol>
<li>单播：一对一通信，可做源地址+目的地址。</li>
<li>多播：一对多通信，可做目的地址，分组被交付到一组计算机中的每台计算机。</li>
<li>任播：一对多中的一个通信，目的站是一组计算机，但数据报之交付给其中的一台计算机，通常是最近的计算机。</li>

</ol>
</li>
<li><p>IPv6地址扩展了IPv4的分级概念，采用三个等级</p>
<ol>
<li>第一级（顶级）指明全球都知道的公共拓扑。</li>
<li>第二级（场点级）指明单个场点。</li>
<li>第三级指明单个网络接口。</li>

</ol>
</li>

</ol>
<h3 id='3）ipv4向ipv6过渡策略'>（3）IPv4向IPv6过渡策略</h3>
<ol>
<li><p>双协议栈</p>
<ol>
<li>双协议栈是指在一台设备上同时装有IPv4和IPv6协议栈，那么这台设备既能和IPv4网络通信，又能和IPv6网络通信。</li>
<li>如果这台设备是一个路由器，那么在路由器的不同接口上分别配置了IPv4地址和IPv6地址，并很可能分别连接了 IPv4 网络和IPv6 网络。</li>
<li>如果这台设备是一台计算机，那么它将同时拥有IPv4 地址和IPv6 地址，并具备同时处理这两个协议地址的功能。</li>

</ol>
</li>
<li><p>隧道技术</p>
<ol>
<li>隧道技术是在IPv6数据报要进入IPv4网络时，把整个IPV6数据报封装到IPV4 数据报的数据部分，使得 IPV6 数据报就好像在IPv4 网络的隧道中传输。</li>
<li> <img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%882.28.55.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午2.28.55"></li>

</ol>
</li>

</ol>
<p>&nbsp;</p>
<h2 id='六路由协议'>六、路由协议</h2>
<h3 id='1）路由协议'>（1）路由协议</h3>
<ol>
<li>自制系统（Autonomous System，AS）：单一技术管理下的一组路由器，这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在 AS 之间的路由。</li>
<li>一个自治系统的所有路由器在本自治系统内都必须是连通的。</li>

</ol>
<h3 id='2）域内路由与域间路由'>（2）域内路由与域间路由</h3>
<ol>
<li><p>自治系统内部的路由选择称为域内路由选择，自治系统之间的路由选择称为域问路由选择。</p>
</li>
<li><p>因特网有两大类路由选择协议。</p>
<ol>
<li><p>内部网关协议（Interior Gateway Protocol, IGP）</p>
<ol>
<li>内部网关协议即在一个自治系统内部使用的路由选择协议，它与互联网中其他自治系统选用什么路由选择协议无关。</li>
<li>目前这类路由选择协议使用得最多，如RIP和OSPF。</li>

</ol>
</li>
<li><p>外部网关协议(External Gateway Protocol, EGP)</p>
<ol>
<li>若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时（两个自治系统可能使用不同的IGP)，就需要使用一种协议将路由选择信息传递到另一个自治系统中，这样的协议就是外部网关协议(EGP)。</li>
<li>目前使用最多的外部网关协议是BGP-4。</li>

</ol>
</li>

</ol>
</li>
<li><p> <img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%882.35.21.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午2.35.21"></p>
</li>

</ol>
<h3 id='3）rip协议'>（3）RIP协议</h3>
<ol>
<li><p>RIP协议，要求网络中的每一个路由器都维护从他自己到其他每一个目的网络的唯一最佳距离记录，是因特网的协议标准，最大优点是简单，最经典的是RIP算法。</p>
</li>
<li><p>距离：通常用跳数表示距离，即从源端口到目的端口所经过的路由器个数，经过一个路由器跳数+1。从一路由器到直接连接的网络距离为1。<strong>RIP允许一条路最多包含15个路由器，因此距离16表示网络不可到达</strong>。</p>
</li>
<li><p>RIP协议只适用于小互联网。</p>
</li>
<li><p>RIP协议通过在路由器之间交换路由表实现距离向量</p>
<ol>
<li>路由器仅和相邻路由器交换信息。</li>
<li>路由器交换信息是自己的路由表</li>
<li>每30s交换一次路由信息并更新，若超过180s没收到邻居的信息则认为邻居消失并更新路由表。</li>
<li>路由器刚开始工作时只知道直接连接的网络的距离（为1）。</li>
<li>每个路由器也只和数目有限的相邻路由器交换并更新路由信息。</li>
<li>经过若干次更新后，所有路由器最终都会知道到达本系统下任何网络的最短距离和下一跳路由器地址。</li>

</ol>
</li>
<li><p>更新路由表原则</p>
<ol>
<li>获知一条新的路由，在本节点的路由表中不存在，加入新的路由。</li>
<li>获知的路由中有到达某个目的地的路由，该路由比现有路由更短，则用新路由替换旧路由。</li>

</ol>
</li>
<li><p>RIP协议的报文格式：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-01%20%E4%B8%8B%E5%8D%885.08.12.png" referrerpolicy="no-referrer" alt="截屏2023-07-01 下午5.08.12"></p>
</li>
<li><p>RIP协议在当网络出现故障时，需要较长的时间才能将此信息传送到所有路由器——慢收敛。</p>
</li>

</ol>
<h3 id='4）开放最短路径优先ospf）协议'>（4）开放最短路径优先（OSPF）协议</h3>
<ol>
<li><p>“开放：表明OSPF协议不是受某一厂商控制的，而是公开发表的。</p>
</li>
<li><p>”最短路径优先”：是因为使用了Dijkstra提出的最短路径算法SPF。</p>
</li>
<li><p>OSPF和RIP相比有以下区别</p>
<ol>
<li>OSPF使用<em>洪泛法</em>向AS中的所有路由器发送信息。</li>
<li>发送的信息是本路由器相邻的所有路由器的链路状态，链路状态说明本路由器和谁相邻以及链路的“度量”。</li>
<li>只有当链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，并且更新过程收敛很快。</li>
<li>OSPF是网络层协议，不实用UDP或TCP，直接用IP数据报传送，而RIP是应用层协议，在传输层使用UDP。</li>

</ol>
</li>
<li><p>OSPF特点</p>
<ol>
<li>OSPF对不同链路可根据IP分组的不同服务类型（TOS）设备不同的度量。</li>
<li>如果到同一个网络有多条相同代价的路径，那么可以将通信量分配给这几条路径，这称为多路径间的负载平衡。</li>
<li>所有在OSPF路由器之间交换的分组都具有鉴别功能，因此保证在可信赖的路由器之间交换交换链路状态信息。</li>
<li>支持可变长度的子网划分和CIDR。</li>
<li>每个链路状态都带上一个32位的序号，序号越大，状态就越新。</li>

</ol>
</li>
<li><p>OSPF的五种分组类型：</p>
<ol>
<li>问候分组：用来发现和维持邻站的可达性。</li>
<li>数据库描述分组：向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。</li>
<li>链路状态请求分组：向对方请求发送某些链路状态项目的详细信息。</li>
<li>链路状态更新分组：用洪泛法对全网更新链路状态。</li>
<li>链路状态确认分组：对链路更新分组的确认。</li>

</ol>
</li>
<li><p>OSPF的步骤</p>
<ol>
<li>每个路由器发现它的邻居结点【HELLO问候分组】，并了解邻居节点的网络地址，</li>
<li>设置到它的每个邻居的成本度量metric。</li>
<li>构造【DD数据库描述分组】，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。</li>
<li>如果数据库描述分组中的摘要自己都有，则邻站不做处理；如果有没有的或者是更新的，则发送【LSR链路状态请求分组】请求自己没有的和比自己更新的信息。</li>
<li>收到邻站的LSR分组后，发送【LSU链路状态更新分组】进行更新。</li>
<li>更新完毕后，邻站返回一个【LSAck链路状态确认分组】进行确认。</li>
<li>路由器的链路状态发生变化，泛洪发送【LSU链路状态更新分组】进行更新。</li>
<li>更新完毕后，其他站返回一个【LSAck链路状态确认分组】进行确认。</li>
<li>使用Dijkstra根据自己的链路状态数据库构造到其他节点间的最短路径。</li>

</ol>
</li>
<li><p>OSPF的区域<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%882.55.54.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午2.55.54"></p>
<ol>
<li>为了使OSPF能够用于更大的网络，OSPF将一个AS划分成更小的区域，每个区域都有一个32位的区域标识符。</li>
<li>使用区域的好处在于利用洪泛法交换信息可以局限于一个区域而不是AS，减少了整个网络上的通信量。</li>

</ol>
</li>
<li><p>OSPF分组<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%882.59.59.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午2.59.59"></p>
</li>
<li><p>OSPF的优点</p>
<ol>
<li>当互联网规模很大时，OSPF比RIP好很多。</li>
<li>OSPF的收敛速度很快。</li>

</ol>
</li>

</ol>
<h3 id='5）边界网关协议bgp）'>（5）边界网关协议（BGP）</h3>
<ol>
<li><p>BGP是不同AS的路由器之间交换路由信息的协议，由于因特网规模极大，AS之间路由选择困难；AS之间的路由选择要找到最佳路由是不现实的；AS之间的路由选择需要考虑有关策略，倒是BGP只能寻找一条能够到达目的网络且较好的路由。</p>
</li>
<li><p>BGP是应用层协议，是基于TCP的。</p>
</li>
<li><p>BGP的工作原理：</p>
<ol>
<li>每个自治系统的管理员要选择至少一个路由器（可以有多个）作为该自治系统的“BGP发言人”。</li>
<li>一个BGP发言人与其他自治系统中的BGP发言人要交换路由信息，就要先建立 TCP 连接，然后在此连接上交换BGP报文以建立BGP会话，再利用 BGP 会话交换路由信息。</li>
<li>当所有BGP发言人都相互交换网络可达性的信息后，各BGP发言人就可找出到达各个自治系统的较好路由。</li>
<li>每个BGP发言人除必须运行BGP外，还必须运行该AS所用的内部网关协议。</li>
<li>BGP所交换的网络可达性信息就是要到达某个网络（用网络前缀表示） 所要经过的一系列
AS。</li>
<li>图例：<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%883.11.55.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午3.11.55"></li>

</ol>
</li>
<li><p>BGP报文格式<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%883.12.40.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午3.12.40"></p>
</li>
<li><p>BGP的特点</p>
<ol>
<li>BGP交换路由信息的结点数量级是自治系统的数量级，比这些自治系统中的网络数少很多。每个自治系统中BGP 发言人（或边界路由器）的数目是很少的。这样就使得自治系统之
间的路由选择不致过分复杂。</li>
<li>BGP支持CIDR，因此BGP的路由表也就应当包括目的网络前级、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列。</li>
<li>在BGP刚运行时，BGP的邻站交换整个BGP路由表，但以后只需在发生变化时更新有变化的部分。这样做对节省网络带宽和减少路由器的处理开销都有好处。</li>

</ol>
</li>
<li><p>BGP-4的四种报文</p>
<ol>
<li>打开（Open）报文：用来与相邻的另一个BGP 发言人建立关系。</li>
<li>更新 （Update）报文：用来发送某一路由的信息，以及列出要撤销的多条路由。</li>
<li>保活（Keepalive）报文：用来确认打开报文并周期性地证实邻站关系。</li>
<li>通知 （Notification）报文：用来发送检测到的差错。</li>

</ol>
</li>

</ol>
<h3 id='6）三种路由协议的比较'>（6）三种路由协议的比较</h3>
<p><img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%883.15.15.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午3.15.15"></p>
<p>&nbsp;</p>
<h2 id='七ip组播'>七、IP组播</h2>
<h3 id='1）组播的概念'>（1）组播的概念</h3>
<ol>
<li>当网络中的某些用户需要特定数据时，组播数据发送者仅发送一次数据，借助组播路由协议为组播数据包建立组播分发树，被传递的数据到达距离用户端尽可能近的节点后才开始复制和分发，是一种点对多点传输方式。</li>
<li>组播就是让源计算机一次发送的单个分组可以抵达用一个组地址标识的若干目标主机，并被他们正确接受。</li>
<li>组播提高了数据传送效率。减少了主干网出现拥塞的可能性。组播组中的主机可以是在同一个物理网络，也可以来自不同的物理网络（如果有组播路由器的支持）。<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%883.32.20.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午3.32.20"></li>

</ol>
<h3 id='2）ip组播地址'>（2）IP组播地址</h3>
<ol>
<li><p>IP组播地址让源设备能够将分组发送给一组设备，属于多播组的设备将被分配一个组播组IP地址（一群共同需求主机的相同标识）。</p>
</li>
<li><p>IP组播使用D类地址格式，地址范围是224.0.0.0～239.255.255.255，一个D类地址表示一个组播组，只能用作分组的目的地址，源地址总为单播地址。</p>
</li>
<li><p>组播数据报也是尽最大努力交付，不提供可靠交付。</p>
</li>
<li><p>组播数据报不产生ICMP差错报文，因此PING不可用于组播地址。</p>
</li>
<li><p>IP组播分为在本LAN上的硬件组播和在因特网上的组播，而在因特网上组播的最后还是需要通过在LAN上用硬件组播交付数据报。</p>
</li>
<li><p>硬件组播<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%883.48.09.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午3.48.09"></p>
<ol>
<li>同单播地址一样，组播地址也需要相应的组播MAC地址在LAN传播。</li>
<li>组播MAC地址以十六进制01-00-5E开头，后面6个十六进制位根据IP组播组地址的最后23位转换得到。</li>
<li>所以IP组播的MAC地址只有23位来表示，而D类地址有28位表示，所有将会出现32个D类地址共享一个MAC地址的现象，因此需要在IP层通过软件对收到的组播数据报进行过滤。</li>

</ol>
</li>

</ol>
<h3 id='3）igmp协议'>（3）IGMP协议</h3>
<ol>
<li><p>因特网组管理协议（IGMP）的目的就是使路由器知道组播组成员的信息，让路由器知道本LAN上是否有主机加入或退出了某个组播组。</p>
</li>
<li><p>IGMP工作的两个阶段：</p>
<ol>
<li>当某台主机加入新的组播组时，该主机应向组播组的组播地址发送一个IGMP报文，声明自己要成为该组的成员。本地的组播路由器收到IGMP 报文后，将组成员关系转发给因特网上的其他组播路由器。</li>
<li>本地组播路由器周期性地探询本地局域网上的主机，以便知道这些主机是否仍继续是组的成员。只要对某个组有一台主机响应，那么组播路由器就认为这个组是活跃的。但一个组在经过几次的探询后仍然没有一台主机响应时，则不再将该组的成员关系转发给其他的组播路由器。</li>

</ol>
</li>

</ol>
<h3 id='4）组播路由选择协议'>（4）组播路由选择协议</h3>
<ol>
<li><p>组播路由选择协议就是要找出以源主机为根节点的组播转发树，其中每个分组在每条链路上只传送一次。<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%883.56.58.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午3.56.58"></p>
</li>
<li><p>对于不同的多播组对应于不同的多播转发树，同一个多播组，对不同的源点也会有不同的转发树。</p>
</li>
<li><p>组播路由选择协议的三种算法</p>
<ol>
<li>基于链路状态的路由选择</li>
<li>基于距离向量的路由选择</li>
<li>协议无关的组播（悉数/密集）</li>

</ol>
</li>

</ol>
<p>&nbsp;</p>
<h2 id='八移动ip'>八、移动IP</h2>
<h3 id='1）移动ip'>（1）移动IP</h3>
<ol>
<li><p>移动IP技术是指移动站以固定的网络IP地址实现跨越不同网段的漫游功能，并保证基于网IP的网络权限在漫游过程中不发生任何改变。</p>
</li>
<li><p>移动IP的目标是把分组自动地投递给移动站，一个移动站是把其连接点从一个网络或子网改变到另一个网络或子网的主机。</p>
</li>
<li><p>移动 IP 定义了三种功能实体：</p>
<ol>
<li>移动节点：具有永久卫地址的移动站。</li>
<li>本地代理：通常就是连接在归属网络（原始连接到的网络）上的路由器。</li>
<li>外地代理：通常就是连接在被访网络（移动到另一地点所接入的网络）上的路由器。</li>

</ol>
</li>

</ol>
<h3 id='2）移动ip的通信过程'>（2）移动IP的通信过程</h3>
<ol>
<li><p>在移动IP中，每个移动站都有一个原始地址，即永久地址（或归属地址），移动站原始连接的网络称为归属网络，永久地址和归属网络的关联是不变的。归属代理通常是连接到归属网络上的路由器，然而它实现的代理功能是在应用层完成的。</p>
</li>
<li><p>当移动站移动到另一地点，所接入的外地网络也称被访网络。被访网络中使用的代理称为外地代理，它通常是连接在被访网络上的路由器。</p>
</li>
<li><p>外地代理有两个重要功能：</p>
<ol>
<li>要为移动站创建一个临时地址，称为转交地址。转交地址的网络号显然和被访网络一致。</li>
<li>及时把移动站的转交地址告诉其归属代理。</li>

</ol>
</li>
<li><p>移动IP技术的基本通信流程如下：</p>
<ol>
<li>移动站在归属网络时，按传统的TCP/IP方式进行通信。</li>
<li>移动站漫游到外地网络时，向外地代理进行登记，以获得一个临时的转交地址。外地代理要向移动站的归属代理登记移动站的转交地址。</li>
<li>归属代理知道移动站的转交地址后，会构建一条通向转交地址的隧道，将截获的发送给移动站的IP分组进行再封装，并通过隧道发送给被访网络的外地代理。</li>
<li>外地代理把收到的封装的数据报进行拆封，恢复成原始的IP分组，然后发送给移动站，这样移动站在被访网络就能收到这些发送给它的IP分组。</li>
<li>移动站在被访网络对外发送数据报时，仍然使用自己的永久地址作为数据报的源地址，此时显然无须通过A的归属代理来转发，而是直接通过被访网络的外部代理。</li>
<li>移动站移动到另一外地网络时，在新外地代理登记后，然后新外地代理将移动站的新转交地址告诉其归属代理。无论如何移动，移动站收到的数据报都是由归属代理转发的。</li>
<li>移动站回到归属网络时，移动站向归属代理注销转交地址。</li>

</ol>
</li>

</ol>
<p>&nbsp;</p>
<h2 id='九网络层设备'>九、网络层设备</h2>
<h3 id='1）路由器'>（1）路由器</h3>
<ol>
<li><p>路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是转发分组。</p>
</li>
<li><p>当源主机向目标主机发送数据报时，路由器先检查源主机和目标主机是否在一个网络上，如果在同一个网络则直接交付无需通过路由器。如果不在一个网络，需要通过路由器转发给下一个路由器。可见跨网络的交付必须要路由器参与。</p>
</li>
<li><p>路由器体系结构<img src="./assets/imgs/%E6%88%AA%E5%B1%8F2023-07-02%20%E4%B8%8B%E5%8D%884.11.31.png" referrerpolicy="no-referrer" alt="截屏2023-07-02 下午4.11.31"></p>
<ol>
<li><p>路由选择部分也称控制部分，其核心构件是路由选择处理机。路由选择处理机的任务是根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断更新和维护路由表。</p>
</li>
<li><p>分组转发部分由三部分组成：交换结构、一组输入端口、一组输出端口。</p>
<ol>
<li>输入端口在从物理层接收到的比特流中提取出数据链路层帧，进而从帧中提取出网络层数据报，</li>
<li>输出端口则执行恰好相反的操作，输入输出端口是有缓冲区的，如果接受数据报的速度超过了处理的速度，就会导致缓冲区满而丢失数据报。</li>
<li>交换结构是路由器的关键部件，它根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去。</li>

</ol>
</li>

</ol>
</li>
<li><p>路由器主要完成两个功能：一是分组转发，二是路由计算。前者处理通过路由器的数据流，关键操作是转发表查询、转发及相关的队列管理和任务调度等；后者通过和其他路由器进行基于路由协议的交互，完成路由表的计算。</p>
</li>
<li><p>路由器和网桥的重要区别是：网桥与高层协议无关，而路由器是面向协议的，它依据网络地址进行操作，并进行路径选择、分段、帧格式转换、对数据报的生存时间和流量进行控制等。现今的路由器一般都提供多种协议的支持，包括 OSI、TCP/IP、IX 等。</p>
</li>

</ol>
<h3 id='2）路由表和路由转发'>（2）路由表和路由转发</h3>
<ol>
<li>路由表是根据路由选择算法得出的，主要用途是路由选择，依靠软件实现。</li>
<li>转发表由路由表的来，可用软件实现也可用特殊硬件实现。转发表必须包含完成转发所必需的信息。在转发表的每一行必须包含目的网络的输出端口和某些MAC地址的映射。</li>
<li>转发是路由器根据转发表把收到的IP数据报从合适的端口转发出去，仅涉及一个路由器，但是路由转发则涉及很多路由器。</li>

</ol>
</body>
</html>